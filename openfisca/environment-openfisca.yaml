# run command ansible-playbook with --ask-become-pass
- hosts : atlantide
  remote_user: openfisca
  tasks:
    - name: Ensure no environment is activated in bash
      lineinfile: dest=~/.bashrc regexp="miniconda2/envs" line='. miniconda2/envs/OpenFisca/bin/activate OpenFisca' state=absent
    - name: Remove OpenFisca environment
      shell: conda remove --name OpenFisca --all -y
    - name: Create environment
      shell: conda create --name OpenFisca gunicorn numpy PyYAML requests Babel nose -y
    - name: Add env to bashrc path
      lineinfile: dest=~/.bashrc line='. miniconda2/envs/OpenFisca/bin/activate OpenFisca'
    - name: Install Biryani, conda doesn't have this package
      shell: pip install Biryani
    - include_vars: openfisca-versions.yml
    - name: Install OpenFisca core
      shell: pip install -e git+https://github.com/openfisca/openfisca-core.git@{{version_core}}#egg=OpenFisca-Core
      #args:
      #  executable: /bin/bash
    - name: Install OpenFisca france
      shell: pip install -e git+https://github.com/openfisca/openfisca-france.git@{{version_france}}#egg=OpenFisca-France
      #args:
      #  executable: /bin/bash
    - name: Install OpenFisca Web API
      shell: pip install -e git+https://github.com/openfisca/openfisca-web-api.git@{{version_web_api}}#egg=OpenFisca-Web-API
      #args:
      #  executable: /bin/bash
    - name: Install OpenFisca Parsers
      shell: pip install -e git+https://github.com/openfisca/openfisca-parsers.git@{{version_parsers}}#egg=OpenFisca-Parsers
      #args:
      #  executable: /bin/bash
